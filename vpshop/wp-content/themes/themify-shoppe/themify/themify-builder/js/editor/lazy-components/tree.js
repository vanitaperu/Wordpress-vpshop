((e,t,i,s)=>{"use strict";e.Tree={init(){const o=i.tfId("tb_tree_root"),n=o.firstElementChild;n&&(o.attachShadow({mode:n.getAttribute("shadowrootmode")}).appendChild(n.content),n.remove()),e.isVisual&&s.top.document.body.appendChild(o),this.el=o.shadowRoot.querySelector(".wrapper"),t.loadCss(t.builder_url+"/css/editor/components/tree",null,null,this.el),t.on("themify_builder_ready",(()=>{const t=e.MainPanel.el.getRootNode().querySelector("#module_combine_style");o.shadowRoot.prepend(e.ToolBar.getBaseCss(),t.cloneNode(!0),this.getGridCss()),setTimeout((()=>{this.events(),this.draggable(),this.resize()}),200)}),!0,e.is_builder_ready)},getGridCss(){const e=(i.tfId("themify_concate-css")||i.tfId("themify-builder-style-css")).sheet.cssRules,t=[],s=[],o=ThemifyStyles.getColSize(),n=ThemifyStyles.getArea(),l=ThemifyStyles.getGutter(),r=i.createElement("style");for(let e in l)s.push("--"+e+":"+l[e]);let a;for(let i=e.length-1;i>-1;--i){let r=e[i].selectorText;if(r)if(r.includes(".row_inner")&&r.includes(".subrow_inner")&&e[i].cssText.includes("--col")&&e[i].cssText.includes("grid-template-areas")){let t=e[i].cssText.replace(r,"").replace("{","").replace("}","").trim().split(";");a=r;for(let e=t.length-1;e>-1;--e)if(t[e]){let i=t[e].split(":")[0].trim();if(i&&void 0===o[i]&&void 0===n[i]&&void 0===l[i]){let i=t[e].replace(";","").trim();s.includes(i)||s.push(i)}}}else r.includes(".module_column")&&(e[i].cssText.includes("grid-area")||e[i].cssText.includes("grid-template-columns"))&&t.push(e[i].cssText.trim())}for(let e in o)s.push(e+":"+o[e]);for(let e in n)s.push(e+":"+ThemifyStyles.normalizeArea(n[e]));return t.push(a+"{"+s.join(";")+"}"),r.id="grid_css",r.innerHTML=t.join(""),r},getTree(){console.time("TREE");const t=i.createElement("template"),s=i.createElement("button");s.type="button",s.className="tf_plus_icon tf_rel",t.innerHTML=e.Builder.get().el.outerHTML;const o=t=>{const n=t[0].classList.contains("module_row")?"row":"subrow";for(let l=t.length-1;l>-1;--l)if(t[l].classList.contains("module_"+n)){t[l].classList.remove("themify_builder_row","tf_clearfix"),t[l].removeAttribute("style");let r=t[l].children;for(let t=r.length-1;t>-1;--t){let l=r[t].classList;if(l.contains(n+"_inner")||l.contains("tb_row_info")){r[t].removeAttribute("style");let l=r[t].children;for(let t=l.length-1;t>-1;--t)if(l[t].classList.contains("module_column")){l[t].removeAttribute("style");let r=l[t].children;for(let t=r.length-1;t>-1;--t){let s=r[t].classList;if(s.contains("tb_holder")){r[t].removeAttribute("style");let s=r[t].children;for(let t=s.length-1;t>-1;--t){let n=s[t],l=n.classList;if(l.contains("active_module"))if(n.removeAttribute("style"),l.contains("active_subrow")){let e=n.children;for(let t=e.length-1;t>-1;--t)e[t].classList.contains("module_subrow")||e[t].remove();o(e)}else{let t=i.createElement("div"),s=i.createElement("div"),o=e.Registry.get(n.dataset.cid),l=o.getExcerpt();n.innerHTML=o.getImage(),t.innerHTML=o.getName(),t.className="module_name",s.className="excerpt",s.innerHTML=l,n.append(t,s)}else n.remove()}}else s.contains("tb_grid_drag")||s.contains("tb_col_side")||r[t].remove()}let a=s.cloneNode(!0);a.textContent="row"===n?"Column":"SubColumn",l[t].prepend(a)}else l[t].remove()}else r[t].remove()}let a=s.cloneNode(!0);a.textContent=n,t[l].prepend(a)}else t[l].remove()};return o(t.content.firstChild.children),console.timeEnd("TREE"),t.content},open(){const i=this.el.tfClass("content")[0],s=this.getTree();i.replaceChildren(s),e.ToolBar.el.tfClass("tree")[0].classList.add("active"),this.el.style.transform="translate("+t.w/2+"px,"+t.h/2+"px)",this.el.getRootNode().host.classList.remove("tf_hide")},extend(e){const t=e.closest(".module_subrow,.module_column,.module_row");t&&t.classList.toggle("expand")},events(){this.el.tfOn(t.click,(e=>{e.stopPropagation();const t=e.target;t.closest(".tf_close")?this.close():t.closest(".minimize")?this.minimize():this.extend(t)}),{passive:!0})},close(){this.el.getRootNode().host.classList.add("tf_hide"),e.ToolBar.el.tfClass("tree")[0].classList.remove("active"),this.el.tfClass("content")[0].replaceChildren()},minimize(){this.el.classList.toggle("is_minimized")},draggable(){const t=this;this.el.tfClass("header")[0].tfOn("pointerdown",(function(i){if(0===i.button){if(!i.target.classList.contains("title")&&i.target!==this)return;i.stopImmediatePropagation();let s,o=t.el,n=this.ownerDocument;const l=i.clientX,r=i.clientY,a=o.getBoundingClientRect(),m=a.left-l,c=a.top-r,_=e=>{e.stopImmediatePropagation(),s=requestAnimationFrame((()=>{o.style.transform="translate("+(m+e.clientX)+"px,"+(c+e.clientY)+"px)"}))},p=e=>{e.stopImmediatePropagation()};o.style.willChange="transform",this.tfOn("lostpointercapture",(function(i){i.stopImmediatePropagation(),s&&cancelAnimationFrame(s),this.tfOff("pointermove",p,{passive:!0,once:!0}).tfOff("pointermove",_,{passive:!0}),o.style.willChange="",!1===t.isStandalone&&(t.updateStorage(),t.setupLightboxSizeClass()),n.body.classList.remove("tb_start_animate","tb_drag_lightbox"),e.ToolBar.el.classList.remove("tb_start_animate","tb_drag_lightbox"),e.MainPanel.el.classList.remove("tb_start_animate","tb_drag_lightbox"),s=o=n=null}),{passive:!0,once:!0}).tfOn("pointermove",p,{passive:!0,once:!0}).tfOn("pointermove",_,{passive:!0}).setPointerCapture(i.pointerId)}}),{passive:!0})},resize(){const e=this,t=this.el.tfClass("tb_resizable");for(let i=t.length-1;i>-1;--i)t[i].tfOn("pointerdown",(function(t){if(0===t.button){t.stopImmediatePropagation();let i,s=this.ownerDocument,o=e.el;o.style.willChange="transform,width,height";const n=350,l=880,r=.9*s.documentElement.clientHeight,a=parseInt(getComputedStyle(o).getPropertyValue("min-height")),m=this.dataset.axis,c=parseInt(o.offsetHeight,10),_=parseInt(o.offsetWidth,10),p=t.clientX,h=t.clientY,d=e=>{e.stopImmediatePropagation(),i=requestAnimationFrame((()=>{let t;const i=e.clientX,s=e.clientY,d=new DOMMatrix(getComputedStyle(o).transform);if("w"===m)t=p+_-i,t>l&&(t=l),t>=n&&t<=l&&(d.m41+=parseInt(o.style.width)-t,o.style.width=t+"px");else{const e="-y"===m||"ne"===m||"nw"===m?h+c-s:c+s-h;t="sw"===m||"nw"===m?p+_-i:_+i-p,t>l&&(t=l),("se"===m||"x"===m||"sw"===m||"nw"===m||"ne"===m)&&t>=n&&t<=l&&("sw"!==m&&"nw"!==m||(d.m41+=parseInt(o.style.width)-t),o.style.width=t+"px"),("se"===m||"y"===m||"-y"===m||"sw"===m||"nw"===m||"ne"===m)&&e>=a&&e<=r&&("-y"!==m&&"nw"!==m&&"ne"!==m||(d.m42+=parseInt(o.style.height)-e),o.style.height=e+"px")}o.style.transform="translate("+d.m41+"px,"+d.m42+"px)"}))},f=function(e){e.stopImmediatePropagation(),i&&cancelAnimationFrame(i),this.tfOff("pointermove",d,{passive:!0}),o.style.willChange="",s.body.classList.remove("tb_start_animate"),s=o=i=null};this.tfOn("pointermove",d,{passive:!0}).tfOn("lostpointercapture",f,{passive:!0,once:!0}).setPointerCapture(t.pointerId),s.body.classList.add("tb_start_animate")}}),{passive:!0})}},e.isGSPage||e.Tree.init()})(tb_app,Themify,document,window);