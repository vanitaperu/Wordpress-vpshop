((t,e,i,a,o)=>{(()=>{let l=!1;const n=o.ext,r={application:{"x-zip-compressed":"zip|",json:"json|"},text:{plain:"txt|"},image:n.image||{},video:n.video||{},audio:n.audio||{}},s=o=>{const l=i.createElement("template"),n={height:"auto",width:"auto",whiteSpace:"normal",wordSpacing:"0px",textIndent:"0px",textTransform:"none",overflow:"visible",fontVariantLigatures:"normal",fontVariantCaps:"normal","font-variant-east-asian":"normal","font-variant-numeric":"normal","font-variant-alternates":"normal","font-feature-settings":"normal","font-variation-settings":"normal","font-kerning":"auto","-webkit-text-stroke-width":"0px"};e.isRTL||(n.textAlign="left"),l.innerHTML=o.replaceAll("<!--StartFragment-->","").replaceAll("<!--EndFragment-->","").trim();const r=l.content;r.firstChild.nodeType===a.TEXT_NODE&&"\n\n"===r.firstChild.textContent&&r.firstChild.remove(),r.lastChild.nodeType===a.TEXT_NODE&&"\n\n"===r.lastChild.textContent&&r.lastChild.remove(),r.firstChild.nodeType===a.COMMENT_NODE&&r.firstChild.remove(),r.lastChild.nodeType===a.COMMENT_NODE&&r.lastChild.remove();for(let t=r.querySelectorAll("*"),e=t.length-1;e>-1;--e){let i=t[e],o=i.tagName;("SCRIPT"===o||"TEMPLATE"===o||"NOSCRIPT"===o||"STYLE"===o||"LINK"===o||i.nodeType===a.COMMENT_NODE||"none"===i.style.display||"hidden"===i.type&&"INPUT"===o||0===i.childNodes.length&&-1!==o.indexOf("-"))&&i.remove()}let s=i.createElement("div");s.className="tf_abs_t tf_opacity tf_hidden tf_rel tb_dummy_html",s.style.top="-10000px",s.appendChild(l.content),i.body.appendChild(s);for(let t=s.children,e=t.length-1;e>-1;--e){let i=t[e].style;"absolute"===i.position&&(i.top=i.left=i.right=i.bottom="",i.position="relative")}for(let t=s.tfTag("*"),e=t.length-1;e>-1;--e){let i=t[e],a=i.style,o=a.display||"";if("grid"!==o&&"inline-grid"!==o&&(a.display="flex"),i.offsetWidth&&i.offsetHeight){for(let t=i.attributes,e=t.length-1;e>-1;--e){let a=t[e].name;"class"!==a&&"id"!==a&&0!==a.indexOf("data-")&&0!==a.indexOf("on")&&"contenteditable"!==a&&"draggable"!==a&&"nonce"!==a&&"autofocus"!==a&&"dir"!==a&&"inert"!==a&&"tabindex"!==a||i.removeAttribute(a)}a.display=o,a.opacity=a.direction=a.contentVisibility=a.widows=a.orphans=a.transition="",n.textAlign&&(a.textAlign="");for(let t in n)a[t]===n[t]&&(a[t]="");let t=i.tagName,e=[];if("DIV"!==t&&"SPAN"!==t&&"A"!==t||("0"!==a.padding&&"0px"!==a.padding||(a.padding=""),"0"!==a.margin&&"0px"!==a.margin||(a.margin="")),a.backgroundImage.includes("http")||a.backgroundImage.includes("data:image/")||(a.backgroundImage=a.backgroundAttachment=a.backgroundPosition=a.backgroundRepeat=a.backgroundOrigin=a.backgroundSize=a.backgroundClip=""),a.cssText){let t=a.cssText.split("; ");for(let i=0;i<t.length;++i){let a=t[i],o=a.indexOf(":"),l=a.substring(0,o).trim(),n=a.substring(o+1).trim();";"===n[n.length-1]&&(n=n.slice(0,-1)),"initial"!==n&&0!==l.indexOf("animation")&&(0===n.indexOf("rgb")?n=ThemifyStyles.rgbToHex(n):"0px"===n?n="0":n.includes("calc")||(n=n.replace(/\b(?:0px|0%|0em|0fr)/g,"0")),e.push(l+":"+n.replace(/\s0\./g," .").replace(/\s\s+/g," ").replace(/\.+0*?fr/g,"fr").replace(/\.+0*?\%/g,"%").replace(/\.+0*?em/g,"em").replace(/\.+0*?px/g,"px")))}e.length>0?i.setAttribute("style",e.join(";")):i.removeAttribute("style")}}else i.remove()}const f=new t.Row({cols:[{grid_class:"col-full",element_id:t.Helper.generateUniqueID(),modules:[{mod_name:"text"}]}]}),d={position:"absolute",top:"-10000px",left:"0",width:"100%",visibility:"hidden",opacity:"0"},p=f.el.tfClass("active_module")[0],m=t.Registry.get(p.dataset.cid);p.appendChild(m.preview({content_text:s.outerHTML})),s.remove(),s=p.tfClass("tb_dummy_html")[0];for(let t in d)f.el.style.setProperty(t,d[t],"important");t.Builder.get().el.appendChild(f.el);for(let t=s.tfTag("*"),e=t.length-1;e>-1;--e){let i=t[e],a=i.style,o=i.parentNode;if(o!==s&&a.width&&"grid"!==o.display&&"inline-grid"!==o.display){let t=parseFloat(parseFloat(a.width)/o.offsetWidth*100);t>100&&(t=100),a.width=t+"%"}}return f.destroy(!0),s.innerHTML},f=async a=>{let n=a.getData("text/plain")?.trim()||"",f=a.files;if(n||f?.length>0){l=!0;const d={application:[],image:[],video:[],audio:[]};if(f?.length>0)for(let t=f.length-1;t>-1;--t){let[e,i]=f[t].type.split("/");i=i?.toLowerCase();let a=r[e]&&f[t].size>0?r[e][i]||r[e]["x-"+i]:null;if(a){let i="text"===e?"application":e,o=f[t].name.split(".").pop().toLowerCase();a.includes(o+"|")&&d[i].push(f[t])}}if(d.application.length>0){let e=d.application,a=e[0];for(let t=e.length-1;t>-1;--t)if(e[t].name.includes("themify_builder")){a=e[t];break}await t.ToolBar.initImport({target:i.createElement("div")}),await TB_Import.fileImport(a)}else{let l,r="plain-text",f=parseInt(o.memory)||64,p=f>=255?4:f>=120?3:f>60?2:1,m=d.image,c=d.video,g=d.audio;if(m.length>0||c.length>0||g.length>0){await e.loadJs(e.url+"js/admin/import/import-images",!!window.TF_ImportImages);const a=await TF_ImportImages.init(m.concat(c,g),o.nonce,o.i18n.uploading,p);if(TF_Notification.showHide("done","",1e3),!t.activeModel&&!i.activeElement.isContentEditable){const t=[],e=[],i=[];for(let e=m.length-1;e>-1;--e){let i=a.get(m[e].name);i?.id&&(i.name=m[e].name,t.push(i))}for(let t=c.length-1;t>-1;--t){let i=a.get(c[t].name);i?.id&&(i.name=c[t].name,e.push(i))}for(let t=g.length-1;t>-1;--t){let e=a.get(g[t].name);e?.id&&(e.name=g[t].name,i.push(e))}const o=Math.max(t.length,e.length,i.length);if(o>0){const a=t=>{const e=[];for(let i=0;i<t.length;++i)e.push(t[i].id);return e};if(t.length===o)if(o>1)l={shortcode_gallery:'[gallery ids="'+a(t).join(",")+'"]'},r="gallery";else{const e=t[0];l={url_image:e.src,title_image:e.name.substring(0,e.name.lastIndexOf("."))},r="image"}else if(e.length===o)if(o>1)l={plain_text:'[playlist type="video" ids="'+a(e).join(",")+'"]'};else{const t=e[0];l={url_video:t.src,title_video:t.name.substring(0,t.name.lastIndexOf("."))},r="video"}else if(0){r="audio",l={music_playlist:[]};for(let t=0;t<i.length;++t)l.music_playlist.push({audio_name:i[t].name,audio_url:i[t].src})}else l={plain_text:'[playlist type="audio" ids="'+a(i).join(",")+'"]'}}}}else if(n){let e=a.getData("text/html")?.trim()||"";if(e&&n!==e){const i={msg:"paste_plain_text"},a=await t.LiteLightBox.confirm(i);if(!a)return;"no"===a?(l={content_text:s(e)},r="text"):e=""}else e="";e||(l={plain_text:n})}if(l)try{await t.MainPanel.newModule(r,!0,l)}catch(t){}}l=!1}},d=e=>{const a=e.composedPath()[0]||e.target;a.isContentEditable||t.isPreview||"INPUT"===a.tagName||"TEXTAREA"===a.tagName||i.activeElement.isContentEditable||f(e.clipboardData)};r.audio.mpeg?.includes("m4a|")&&(r.audio["x-m4a"]="m4a|"),r.audio.mpeg?.includes("m4b|")&&(r.audio["x-m4b"]="m4b|");let p=!1;i.tfOn("dragenter",(e=>{const a=e.dataTransfer.items;if(!1===l&&!t.isPreview&&a&&e.target&&"tb_drop_zone"!==e.target.id&&!i.body.classList.contains("tb_start_animate")){let t=!1;for(let e=a.length-1;e>-1;--e){let i=a[e].kind;if("file"===i){let[i,o]=a[e].type.split("/");if(o=o?.toLowerCase(),r[i]&&(r[i][o]||r[i]["x-"+o])){t=!0;break}}else if("string"===i){t=!0;break}}if(!0===t){e.stopPropagation();const t=i.tfId("tb_drop_zone"),a=t=>{t.stopPropagation(),i.body.classList.remove("tb_drop_file")};if(!1===p){p=!0;const e=t=>{t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"},o=n=>{n.stopPropagation(),t.tfOff("drop",l,{once:!0}).tfOff("dragleave",a,{passive:!0,once:!0}).tfOff("dragover",e),i.tfOff("dragend",o,{passive:!0,once:!0}),a(n),p=!1},l=t=>{t.stopPropagation(),t.preventDefault(),o(t),f(t.dataTransfer)};t.tfOn("dragover",e).tfOn("drop",l,{once:!0}),i.tfOn("dragend",o,{passive:!0,once:!0})}t.tfOn("dragleave",a,{passive:!0,once:!0}),i.body.classList.add("tb_drop_file")}}}),{passive:!0}).tfOn("paste",d,{passive:!0}),t.isFrontend&&window.top.document.tfOn("paste",d,{passive:!0})})()})(tb_app,Themify,document,Node,themifyBuilder);