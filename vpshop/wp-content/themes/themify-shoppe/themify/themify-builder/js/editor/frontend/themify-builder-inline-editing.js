((t,e,i,o,n,a,s,l,r,d)=>{"use strict";let _,c,f,u,m,b,p,h,g,w,y,v,T,k=o.tfId("tb_inline_editor_root"),x=null,C=null,I=null,z=null,F=null,N=null,A=!1,q=!1,E=!1,M=!1,R=!1,S=!1,B=!1,L=-1,P=null,G=[];const U=t=>{let o=t.getBoundingClientRect(),n=0,a=0,s=o.top+i.scrollY,l=o.left+i.scrollX;while(null!==t)n+=t.offsetTop-t.scrollTop+t.clientTop,a+=t.offsetLeft-t.scrollLeft+t.clientLeft,t=t.offsetParent;return s-=n,l-=a,e.isRTL||(a+=l),{top:n,left:a,width:o.width,height:o.height,diffTop:s,diffLeft:l}},D=e=>{if(null===P){const o=i.getSelection(),n={el:e};if(G.splice(L+1,G.length-L),0!==o.rangeCount){const e=o.getRangeAt(0).cloneRange();n.r={startOffset:e.startOffset,endOffset:e.endOffset,collapsed:e.collapsed,startContainer:t.Helper.cloneDom(e.startContainer),endContainer:t.Helper.cloneDom(e.endContainer)}}G.push(n),L=G.length-1}},K=(t,...e)=>{o.execCommand("styleWithCSS",!1,!0),o.execCommand(t,!1,e[0]??null)},O=t=>{const e=o.queryCommandState(t);return-1!==e&&e},X={undo:{result(t,e="undo"){P=!0;const o=G[L+("undo"===e?0:1)];if("undo"===e?--L:++L,o!==r){if(o.el===_.innerHTML)return void X[e].result(t);let n=o.r;if(_.innerHTML=o.el,n){let t,e,o,a=n.startOffset,s=n.endOffset,l=n.collapsed,r=n.startContainer,d=n.endContainer;const c=i.getSelection(),f=new Range,u=r.nodeType===Node.TEXT_NODE?r.textContent:null,m=d.nodeType===Node.TEXT_NODE?d.textContent:null,b=i=>{if(t&&e)return;const n=i.childNodes;for(let i=n.length-1;i>-1;--i){if(t&&e)break;o||n[i].nodeType!==Node.TEXT_NODE||(o=n[i]),!t&&(n[i].isEqualNode(r)||null!==u&&n[i].nodeType===Node.TEXT_NODE&&n[i].textContent===u)&&(t=n[i]),!e&&(n[i].isEqualNode(d)||null!==m&&n[i].nodeType===Node.TEXT_NODE&&n[i].textContent===m)&&(e=n[i]),b(n[i])}};b(_),c.removeAllRanges(),_.focus(),t||e||(t=e=o),t&&e&&(f.collapse(l),f.setStart(t,a),f.setEnd(e,s),c.addRange(f))}st()}P=null},state(t,e){const i="redo"===e?L<G.length-1:L>-1;return t?.toggleClass("disabled",!i),i}},redo:{result(t){X.undo.result(t,"redo")},state:t=>X.undo.state(t,"redo")},formatBlock:{result(t){const e=t.parentNode.classList.contains("selected")?"p":t.dataset.action;K("formatBlock","<"+e+">")},state(t){const e=t.tfClass("submenu")[0].tfClass("action"),i=o.queryCommandValue("formatBlock");for(let t=e.length-1;t>-1;--t){let o=e[t].parentNode.classList;i===e[t].dataset.action?o.contains("selected")||(o.add("selected"),nt(e[t])):o.remove("selected")}}},text_align:{result(t){if(t.parentNode.classList.contains("selected")){if(N){if(N.startContainer){N.startContainer.parentNode.style.textAlign="";const t=N.startContainer.parentNode.closest("[style*=text-align]");t&&(t.style.textAlign="")}if(N.commonAncestorContainer){N.commonAncestorContainer.nodeType!==Node.TEXT_NODE&&(N.commonAncestorContainer.style.textAlign="");const t=N.startContainer.parentNode.closest("[style*=text-align]");t&&(t.style.textAlign="")}it()}}else K(t.dataset.action)},state(t){const e=t.tfClass("submenu")[0].tfClass("action");let i=!1;for(let t=e.length-1;t>-1;--t){let o=e[t].parentNode.classList;e[t].hasAttribute("data-action")&&O(e[t].dataset.action)?(o.contains("selected")||nt(e[t]),i=!0):o.remove("selected")}!1===i&&t.classList.remove("selected")}},list:{result(t){K(t.dataset.action)},state(t){X.text_align.state(t)}},image:{state(t){},result(i){const o=a(),n=a("hidden");let s;M=!0,n.tfOn("change",(async i=>{i.stopImmediatePropagation();const l=s.state().get("selection").first().toJSON(),{id:r,title:d=""}=l,f=l.alt||d;let u=_;if(!A){J();K("insertHTML",'<img src="'+l.url+'" class="tb_inserted_image">'),u=_.tfClass("tb_inserted_image")[0],u.classList.remove("tb_inserted_image"),u.removeAttribute("style")}const m=null!==u.closest("[data-has-editor]"),b=u.classList;if(A||m){const o=a("","tf_loader tf_abs_c"),n=u.hasAttribute("data-w")||u.hasAttribute("data-h"),s=!!u.hasAttribute("data-w")&&u.getAttribute("width"),r=!!u.hasAttribute("data-h")&&u.getAttribute("height");if(A&&F.appendChild(o),u.removeAttribute("srcset"),!m&&n?u.dataset.orig=l.url:(u.removeAttribute("data-orig"),m&&(u.alt=f,u.title=d)),n&&(!m||s||r)||(u.width=l.width,u.height=l.height),R=!0,!s&&!r||m)u.src=l.url,Z(!m),await gt(),await e.imagesLoad(u);else{try{await ThemifyImageResize.toBlob(u,s,r)}catch(i){}Z(!m)}if(A){const i=u.closest(".active_module");await e.trigger("tb_image_resize",[_,c,s,r]),pt(),i&&await t.Utils.runJs(i,"module"),bt(),e.requestIdleCallback((()=>{setTimeout((()=>{requestAnimationFrame(bt)}),25)}),500)}else u.click();o.remove()}for(let t=b.length-1;t>-1;--t)if(0===b[t].indexOf("wp-image-")){b.remove(b[t]);break}b.add("wp-image-"+r),n.remove(),o.remove(),M=!1}),{passive:!0,once:!0}),ThemifyConstructor.mediaFile.browse(o,n,ThemifyConstructor,"image"),o.click(),s=ThemifyConstructor.mediaFile._frames.image;const l=()=>{s.off("close",l),M=!1,setTimeout((()=>{s=null}),50)};s.on("close",l)}},link:{state(t){if(N){const t=N.startContainer.parentNode.closest("a"),e=x.classList;t&&t===N.endContainer.parentNode.closest("a")?(I.firstChild.textContent=I.nextElementSibling.href=t.getAttribute("href"),e.add("show_link"),W(),st(!0)):x.classList.contains("show_link")&&(I.firstChild.textContent=I.nextElementSibling.href="",e.remove("show_link"),W(),st(!0))}},result(t){const e=x.tfClass("link_form")[0].cloneNode(!0),i=e.tfClass("link_input")[0],o=e.querySelector("#link_type"),n=N.startContainer.parentNode.closest("a"),a=ThemifyConstructor,s={px:{min:1,max:5e4},"%":{min:1,max:500}};e.querySelector("#lb_w_holder").replaceWith(a.range.render({id:"lb_w",control:!1,units:s},a)),e.querySelector("#lb_h_holder").replaceWith(a.range.render({id:"lb_h",control:!1,units:s},a));const r=e.querySelector("#lb_w"),d=e.querySelector("#lb_h"),_=e.querySelector("#lb_w_unit"),c=e.querySelector("#lb_h_unit");if(i.value=r.value=d.value="",o.selectedIndex=_.selectedIndex=c.selectedIndex=0,n&&n===N.endContainer.parentNode.closest("a")){let t=n.target;if(i.value=n.getAttribute("href"),"_blank"!==t&&n.hasAttribute("data-zoom-config")&&(t="lightbox"),t&&(o.value!==t&&(o.value=t),"lightbox"===t)){const t=n.dataset.zoomConfig.split("|"),i=t[0].includes("%")?"%":"px",o=t[1]&&t[1].includes("%")?"%":"px";l(t[0])!==l(r.value)&&(r.value=l(t[0])),l(t[1])!==l(d.value)&&(d.value=l(t[1])),_.value!==i&&(_.value=i),c.value!==o&&(c.value=o),e.querySelector(".lightbox").classList.remove("tf_hide")}}e.tfOn("focusout change",ot,{passive:!0}).tfOn("submit",ot).querySelector("#link_type").tfOn("change",(t=>{const e=t.currentTarget;e.closest("form").querySelector(".lightbox").classList.toggle("tf_hide","lightbox"!==e.value),J(),W(),st(!0)}),{passive:!0}),z.append(dt(),e),x.classList.add("tf_hide","dialog_open","dialog_link","tf_opacity"),e.classList.remove("tf_hide"),J(),W(),st(!0),setTimeout((()=>{i.focus()}),100)}},font:{state(t){},result(t){let i=s(),n=o.queryCommandValue("fontName");i.appendChild(ThemifyConstructor.font_select.render({id:"",control:!1},ThemifyConstructor)),i=i.firstChild,x.classList.add("tf_hide","dialog_open","dialog_font","tf_opacity"),_t(i);const a=i.tfClass("font-family-select")[0];if(e.triggerEvent(a.closest(".tb_font_preview_wrapper"),"tf_init"),a.tfOn("change",(function(t){t.stopPropagation(),E=!0,J(),K("fontName",this.value||"inherit"),setTimeout((()=>{Y(),E=!1}),10)}),{passive:!0}),J(),W(),st(!0),n&&(n=n.replace(/["']/g,""),a.querySelector('[value="'+CSS.escape(n)+'"]'))){a.value=n,i.tfClass("themify-combo-input")[0].value=n;const t=i.tfClass("themify-combo-dropdown")[0],e=t.querySelector('[data-value="'+CSS.escape(n)+'"]');e&&(e.classList.add("themify-combo-selected"),t.style.scrollBehavior="auto",t.scrollTop=e.offsetTop-e.offsetHeight,t.style.scrollBehavior="")}}},unlink:{result(t){J();const e=N?N.startContainer.parentNode.closest("a"):null;if(e&&e===N.endContainer.parentNode.closest("a")){const t=o.createRange(),n=i.getSelection();t.selectNodeContents(e),n.removeAllRanges(),n.addRange(t)}K("unlink"),Y()}},unlinkBack:{result(t){X.unlink.result(t),ct()}},color:{result(t){const i=t=>{if(E=!0,J(),""===t&&(t="inherit"),K("foreColor",t),"inherit"===t&&N&&N.commonAncestorContainer){const t=N.commonAncestorContainer.querySelectorAll("span[style]");for(let e=t.length-1;e>-1;--e)"inherit"===t[e].style.color&&(t[e].style.color="",t[e].style||(t[e].outerHTML=t[e].innerHTML));it()}setTimeout((()=>{Y(),E=!1}),10)};let n=s(),a=o.queryCommandValue("foreColor");n.appendChild(ThemifyConstructor.color.render({id:"",control:!1},ThemifyConstructor)),n=n.firstChild,x.classList.add("tf_hide","dialog_open","dialog_color","tf_opacity"),_t(n);const r=n.tfClass("tfminicolors-input")[0],d=n.tfClass("tfminicolors-swatch")[0],_=n.tfClass("color_opacity")[0];if(a){let t=1;if(a.includes("rgb")){t=a.includes("rgba")?parseFloat(a.split(",").slice(-1).pop()):1;const e=a.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);a=e&&4===e.length?"#"+("0"+l(e[1],10).toString(16)).slice(-2)+("0"+l(e[2],10).toString(16)).slice(-2)+("0"+l(e[3],10).toString(16)).slice(-2):""}r.value=a,_.value=t}d.click(),r.tfOn("themify_builder_color_picker_change",(t=>{t.stopPropagation();const e=t.detail.val;"dialog_content"!==o.activeElement.id&&z.contains(o.activeElement)&&""!==e||i(e)}),{passive:!0}).tfOn("change",(function(t){t.stopPropagation(),i(jQuery(this).tfminicolors("rgbaString"))}),{passive:!0}),_.tfOn("change",(t=>{R=!0,t.stopPropagation(),e.triggerEvent(r,"change")}),{passive:!0}),W(),st(!0)}}},Z=e=>{if(_&&R){if(!c)return;const i=t.activeModel?.id===c.id;let o,n,a=!1,s=!e&&A,l=_,r=new Map,d=!0;if(B=!0,s){if(o=l.dataset.w,n=l.dataset.h,!o&&!n){if(l=l.closest("[data-has-editor]"),!l)return;s=!1,S=!0}s&&(o&&r.set(o,l.getAttribute("width")),n&&r.set(n,l.getAttribute("height")),d="0"!==l.dataset.globalsize)}if(!s){const t=l.dataset.name;if(t){let e="IMG"===l.tagName?l.dataset.orig||l.src:S?l.innerHTML:l.innerText;c.saveInlinEdit&&(e=c.saveInlinEdit(e,_,t,r,!i)),!1!==e&&null!==e&&r.set(t,e)}}if(0===r.size)return;let f=l.dataset.repeat;if(f&&!isNaN(f)&&(f=!1),f){if(a=!!l.hasAttribute("data-index")&&~~l.dataset.index,!1===a){let t=l.closest(".tf_swiper-slide")||l.closest(".module-"+c.get("mod_name")+"-item")||l.closest("li");if(t){const e=t.parentNode.children;for(let i=e.length-1;i>-1;--i)if(e[i]===t){a=i;break}}}if(!1===a)return}if(i){const e=t.LightBox.el,i=f?e.querySelector("#"+f):null;let s;f?(ThemifyConstructor.settings[f]??=[],ThemifyConstructor.settings[f][a]??={},s=ThemifyConstructor.settings[f][a]):s=ThemifyConstructor.settings;for(let[t,l]of r){let r=i?.querySelectorAll('[data-input-id="'+t+'"]')?.[a]||e.querySelector(".tb_lb_option#"+t);if(!0!==d||o!==t&&n!==t?s[t]=l:ThemifyConstructor.settings[t]=l,r&&r.value!=l){r.value=l;let t=r.closest(".tb_uploader_wrapper")?.querySelector(".tb_media_uploader img");t?t.src=l:S&&tinyMCE?.get(r.id)?.setContent(l)}}}else{const e=c.get("mod_settings")||{};if(f){e[f]??=[],e[f][a]??={};for(let[t,i]of r)!0!==d||o!==t&&n!==t?e[f][a][t]=i:e[t]=i}else for(let[t,i]of r)e[t]=i;t.undoManager.has("inline")||t.undoManager.start("inline",c),c.set("mod_settings",e)}pt(),s||(-1===L&&v&&(D(v),v=null),D(_.innerHTML))}},j=t=>{t.preventDefault()},H=t=>{t.stopImmediatePropagation(),A&&_&&(_.hasAttribute("data-name")||_.closest("[data-has-editor]"))&&F.contains(t.target)&&!t.target.closest(".image_menu")&&X.image.result()},Q=t=>{if(!c||!_||!S||A)return n.tfOff("keydown",Q),void o.tfOff("keydown",Q);if(!0===t.ctrlKey||!0===t.metaKey){const e=o.activeElement.tagName,i=n.activeElement.tagName,a=t.code;"INPUT"!==e&&"TEXTAREA"!==e&&"INPUT"!==i&&"TEXTAREA"!==i&&("KeyY"===a||"KeyZ"===a&&!0===t.shiftKey?(t.preventDefault(),X.redo.state()&&X.redo.result()):"KeyZ"===a&&(t.preventDefault(),X.undo.state()&&X.undo.result()))}},W=()=>{const t=x.className,e=x.classList;e.add("tf_hidden"),e.remove("tf_hide");const i=x.getBoundingClientRect();f=i.width+40,u=i.height+30,x.className=t},Y=()=>{const t=i.getSelection();N=!1===t.isCollapsed?t.getRangeAt(0).cloneRange():null},J=()=>{if(!1===q&&N){q=!0,_.focus();const t=i.getSelection();t.removeAllRanges(),t.addRange(N),q=!1}},V=()=>{if(null===x){if(k.classList.contains("tf_hide")){const e=k.firstElementChild,i=s(),n=t.MainPanel.el.getRootNode().querySelector("#module_combine_style").cloneNode(!0),a=o.tfId("tmpl-builder_row_action").content.querySelector("#module_form_fields_style").cloneNode(!0);i.append(t.ToolBar.getBaseCss(),n,a),e&&(k.attachShadow({mode:e.getAttribute("shadowrootmode")}).appendChild(e.content),e.remove()),k.shadowRoot.prepend(i),k.classList.remove("tf_hide")}x=k.shadowRoot.tfId("toolbar"),C=x.querySelectorAll("[data-type]")}return x},tt=t=>{const e=t.target.closest(".action");if(t.stopPropagation(),!e||"submit"===e.type)return;t.preventDefault(),E=!0;const o=e.closest("[data-type]").dataset.type;"expand"!==o?(-1===L&&v&&(D(v),v=null),X[o]?.result!==r?X[o].result(e):(J(),K(o)),at()):e.classList.contains("disable")||(i.getSelection().removeAllRanges(),c.edit(),gt()),E=!1},et=t=>{const e=t.composedPath()[0].tagName;"BUTTON"!==e&&"SELECT"!==e&&"INPUT"!==e&&(t.stopPropagation(),t.preventDefault())},it=t=>{t?.stopPropagation(),_&&(R=!0,Z())},ot=function(t){t.stopPropagation();const e=t.type;if("submit"===e||"focusout"===e&&!t.target.classList.contains("tb_range")||"change"===e&&t.target.classList.contains("tb_range"))return void("submit"===e&&t.preventDefault());const n=this.tfClass("link_input")[0].value.trim();if(n){R=!0,J();let t=i.getSelection();const e=N?.startContainer.parentNode.closest("a")||null,a=this,s=a.querySelector("#link_type").value;if(e&&e===N.endContainer.parentNode.closest("a")){const i=o.createRange();i.selectNodeContents(e),t.removeAllRanges(),t.addRange(i)}if(K("createLink",n),Y(),t.anchorNode?.parentNode){const e=t.anchorNode.parentNode.closest("a");if(e)if(e.removeAttribute("target"),e.removeAttribute("data-zoom-config"),e.classList.remove("themify_lightbox"),"_blank"===s)e.target=s;else if("lightbox"===s){e.classList.add("themify_lightbox");const t=a.querySelector("#lb_w").value,i=a.querySelector("#lb_h").value,o=a.querySelector("#lb_w_unit").value||"px",n=a.querySelector("#lb_h_unit").value||"px";if(t>0||i>0){let a="|";t&&(a=t+o+a),i&&(a+=i+n),e.dataset.zoomConfig=a}}}}},nt=t=>{const e=t.parentNode,i=e.parentNode.closest("li");e.classList.add("selected"),i&&(i.classList.add("selected"),i.tfClass("action")[0]?.replaceWith(t.cloneNode(!0)))},at=()=>{for(let t=C.length-1;t>-1;--t){let e=C[t],i=e.dataset.type,o="LI"===e.tagName?e:e.parentNode;"expand"===i||"undo"===i||"image"===i||"redo"===i||o.classList.contains("disabled")||(X[i]?.state!==r?X[i].state(o):o.classList.toggle("selected",O(i)))}},st=t=>{if(null===x)return;const o=i.getSelection(),a=x.classList,s=o.isCollapsed;if(C)for(let t=C.length-1;t>-1;--t){let e=C[t],i=e.dataset.type;if("image"!==i&&"expand"!==i){let t="LI"===e.tagName?e:e.parentNode,o="undo"!==i&&"redo"!==i?s:!X[i].state();t.classList.toggle("disabled",o)}}let l;if(a.contains("tf_hide")&&(W(),a.remove("tf_hide"),requestAnimationFrame((()=>{a.remove("tf_opacity")}))),!1===s)Y(),l=N,t===r&&at(),p&&(p.contains("tb_editor_start_select")||(k.classList.add("tb_editor_start_select"),p.add("tb_editor_start_select"),n.body.classList.add("tb_editor_start_select")),clearTimeout(g),g=setTimeout(rt,500));else{if(N=null,ct(),0===o.rangeCount)return;l=o.getRangeAt(0).cloneRange()}let d=l.getBoundingClientRect();0===d.left&&0===d.top&&(d=_.getBoundingClientRect());let c=U(l.startContainer.parentNode),m=d.left+(d.width-f)/2,b=d.top-u-10-c.diffTop,h=!1===s||!1===B;if(m+f>=e.w&&(m-=f+Math.ceil(m)+i.pageXOffset-e.w-1),!0===B&&!1===h){const t=x.getBoundingClientRect().top;h=t<=0||Math.abs(t-b)>160}!0===h&&(a.toggle("top_viewport",b<=0),b<=0&&(b=d.bottom+10),m<=0&&(m=15),b+=i.pageYOffset,x.style.transform="translate("+m+"px,"+b+"px)")},lt=()=>{null!==_&&!1===q&&!1===E&&o.activeElement===_&&(clearTimeout(b),m=requestAnimationFrame((()=>{b=setTimeout((()=>{null!==_&&!1===q&&!1===E&&o.activeElement===_&&st()}),20)})))},rt=()=>{p?.contains("tb_editor_start_select")&&(n.body.classList.remove("tb_editor_start_select"),p.remove("tb_editor_start_select"),k.classList.remove("tb_editor_start_select")),clearTimeout(g),g=null},dt=()=>a("button",{type:"button",class:"tf_close",title:"Back"}).tfOn(e.click,(t=>{t.stopImmediatePropagation(),t.preventDefault(),ct(),x.classList.add("tf_hide","tf_opacity"),J(),W(),st()}),{once:!0}),_t=t=>{const e=a("",{id:"dialog_header"}),i=a("",{id:"dialog_content",tabindex:-1});e.appendChild(dt()),i.appendChild(t),z.append(e,i)},ct=()=>{x&&(x.style.display="none",z?.replaceChildren(),x.classList.remove("dialog_open","dialog_color","dialog_font","dialog_link","show_link"),x.style.display="",W())},ft=t=>{if(null!==F){t.style.transform="none";const e=U(t),i=F.style;i.transform="translate("+e.left+"px,"+e.top+"px)",i.width=e.width+"px",i.height=e.height+"px",t.style.transform=""}},ut=t=>{if(ht(),null===x&&V(),null===F){F=a("",{id:"image_editor",class:"tf_abs_t"});const i=_.dataset.orig||_.currentSrc.trim(),o=i.includes(e.upload_url)||i.includes(e.cdnPlugin)||i.includes("blob:")||i.includes("data:")||i.includes("themify.org")?null!==_.closest("[data-has-editor]")&&d.i18n.img_help2:d.i18n.img_help,n=["w","s","e","n"],l=s();ft(t),h?.el&&h?.once("transitionEnd",(()=>{t.classList.contains("tb_selected_img")&&ft(t)}));for(let t=n.length-1;t>-1;--t)l.append(a("",{class:"image_border tf_abs_t border_"+n[t],"data-axis":n[t]}),a("","image_tooltip tf_opacity tf_textc tf_abs_t image_tooltip_"+n[t]),a("",{class:"image_handler tf_abs_t tb_editor_"+n[t],"data-axis":n[t]}));!1!==o&&l.appendChild(ThemifyConstructor.help(o)),F.tfOn("pointerdown",mt,{passive:!0}),e.isTouch||F.tfOn("dblclick",H,{passive:!0}),_.classList.add("tb_selected_img"),F.appendChild(l),k.shadowRoot.appendChild(F)}},mt=async function(i){if(0!==i.button)return;const n=i.target;if(i.stopPropagation(),_&&(_.hasAttribute("data-w")||_.hasAttribute("data-h")||_.closest("[data-has-editor]"))&&(n.classList.contains("image_handler")||n.classList.contains("image_border"))){this.style.willChange="width,height,transform",_.parentNode.style.willChange="contents",_.style.willChange="width,height";let s,l,f,u,m,b,g=_.dataset.maxw,w=null,y=!1,v=new ThemifyImageResize(_);g&&(g=_.closest(g)),g||(g=_.closest("[data-has-editor]")||_.parentNode),h?.el&&(h.resizing=!0);const x=n.dataset.axis,C=n.classList.contains("image_handler"),I=this,z=40,F=40,N=Number.MAX_VALUE,A=_.getBoundingClientRect(),q=~~A.width,E=~~A.height,M=parseFloat(q/E),S=i.clientX,B=i.clientY,L=I.tfClass("image_tooltip"),P=v.isLocal,G=a("","tf_loader tf_abs_c"),D=!!c.imageEditResize,K=e=>{e.stopPropagation(),f=e.clientX,u=e.clientY,!1===y&&(y=!0,_.decoding="",c.id!==t.activeModel?.id&&t.undoManager.start("inline",c)),cancelAnimationFrame(s),s=requestAnimationFrame((()=>{if(null===_)return void gt();let t,e;!0===C?(t="n"===x||"s"===x?S+q-f:q+f-S,e=~~(t/M)):"s"===x||"n"===x?(e="s"===x?E+u-B:B+E-u,t=q):(t="w"===x?q+f-S:S+q-f,e=E),t<z?t=z:t>N&&(t=N),e!==r&&e<F&&(e=F),m===t&&b===e||(m=t,b=e,v.resize(t,e).then((i=>{const o=U(_),n=I.style;n.transform="translate("+o.left+"px,"+o.top+"px)",n.width=o.width+"px",n.height=o.height+"px",L[0].textContent=L[3].textContent=~~i[1]+"px",L[1].textContent=L[2].textContent=~~i[2]+"px",null!==w&&(w.style.width&&(w.style.width=i[1]+"px"),w.style.height&&(w.style.height=i[2]+"px")),!0===D&&c.imageEditResize(_,v,t,e),pt(!0)})))}))},O=function(i){i?.stopPropagation(),cancelAnimationFrame(s),clearTimeout(l),this.tfOff("pointermove",K,{passive:!0}).tfOff("pointerup",O,{passive:!0,once:!0}),k.classList.remove("tb_image_editor_resizing");if((p||o.body.classList).remove("tb_start_animate","tb_image_editor_resizing"),I.style.willChange=_.style.willChange=_.parentNode.style.willChange="",!0===y){R=!0;let i=_.closest(".active_module,.module_column");Z(),T=new Promise((async o=>{const n=_.getAttribute("width"),a=_.getAttribute("height");if(i){const t="0"!==_.dataset.globalsize?i.querySelectorAll('img[data-w="'+_.dataset.w+'"]'):null;if(t?.length>1){const o=[],s=t.length,l=e.isTouch?4:8,r=e.isTouch?20:10;P&&i.classList.add("tf_image_editor_working");for(let e=s-1;e>-1;--e)try{if(s>l){let i=new Promise(((i,o)=>{setTimeout((()=>{new ThemifyImageResize(t[e]).highQuality(n,a).then(i).catch(o)}),e*r)}));o.push(i)}else{let i=new ThemifyImageResize(t[e]);o.push(i.highQuality(n,a))}}catch(t){}try{await Promise.all(o)}catch(t){}}else await v.highQuality(n,a)}await e.trigger("tb_image_resize",[_,c,n,a]),c.imageEditEnd&&await c.imageEditEnd(_,v,n,a),pt(),!i||_.hasAttribute("data-no-update")||c.inlineUpdateModule&&!c.inlineUpdateModule(_,v,n,a)||await t.Utils.runJs(i,"module"),bt(),setTimeout((()=>{requestAnimationFrame(bt),t.undoManager.has("inline")&&t.undoManager.end("inline"),i?.classList.remove("tf_image_editor_working"),o()}),25)}))}y=!1,s=l=m=b=v=null};if(k.classList.add("tb_image_editor_resizing"),p.add("tb_start_animate","tb_image_editor_resizing"),this.appendChild(G),this.classList.add("image_loading"),c.imageEditStart&&await c.imageEditStart(_,v),!1===v.isLocal){const t=_.closest("[data-has-editor]")?"img_help2":"img_help";TF_Notification.showHide("warning",d.i18n.label[t],4e3)}else w=_.parentNode,null!==w&&"FIGURE"!==w.tagName||(w=null);v.lowQuality().then((()=>{!0===v.isBig&&TF_Notification.showHide("warning",d.i18n.img_big.label.replace("%w",_.naturalWidth).replace("%h",_.naturalHeight),4e3),n.tfOn("pointermove",K,{passive:!0}).setPointerCapture(i.pointerId),I.classList.remove("image_loading"),G.remove()})),n.tfOn("pointerup",O,{passive:!0,once:!0})}},bt=()=>{F&&!p.contains("tb_image_editor_resizing")&&requestAnimationFrame((()=>{F&&_&&!p.contains("tb_image_editor_resizing")&&ft(_)}))},pt=t=>{if(h?.el){const e=h.thumbs?.el.swiper,i=h.constructor?.getParentSwiper(h.el);!0!==t&&(h.updateSlides(),e!==h&&e?.updateSlides(),i!==h&&i?.updateSlides()),h.updateAutoHeight(0),e!==h&&e?.updateAutoHeight(0),i!==h&&i?.updateAutoHeight(0)}},ht=()=>{F&&(F.tfOff("pointerdown",mt,{passive:!0}).tfOff("dblclick",H,{passive:!0}).remove(),F=null)},gt=async a=>{if(M||a&&0!==a.button)return;let s=a?.target;if(!s||!x||0===a.button&&"tb_inline_editor_root"!==s.id&&!x.contains(s)&&!w?.getRootNode().host.contains(s))if(ct(),s&&c&&_?.contains(s))a&&_&&!1===i.getSelection().isCollapsed&&(p.contains("tb_editor_start_select")||(k.classList.add("tb_editor_start_select"),p.add("tb_editor_start_select"),n.body.classList.add("tb_editor_start_select")),this.tfOn("pointerup",rt,{passive:!0,once:!0}));else{if(cancelAnimationFrame(m),clearTimeout(b),o.tfOff("pointerdown",gt,{passive:!0}).tfOff("selectionchange",lt,{passive:!0}).tfOff("pointerup",rt,{passive:!0,once:!0}).tfOff("keydown",Q),n.tfOff("pointerdown",gt,{passive:!0}).tfOff("keydown",Q),await T,rt(),_){_.tfOff("input",it,{passive:!0}),"IMG"!==_.tagName&&(_.contentEditable=!1),_.classList.remove("tb_selected_img");const t=_.closest("form");let e=_.closest("[draggable]");while(null!==e)e.draggable=!0,e=e.parentNode.closest("[draggable]");if(t){const e=t.tfOff("submit",j).querySelectorAll("[data-required]");for(let t=e.length-1;t>-1;--t)e[t].removeAttribute("data-required"),e[t].setAttribute("required","required")}let i=_;while(i?.classList&&!i.classList.contains("active_module"))i.dataset.tmpAnimation&&(i.style.animationName=i.dataset.tmpAnimation,i.removeAttribute("data-tmp-animation")),i=i.parentNode}if(h?.el&&(h.resizing=null,h.autoplay?.start(),h.thumbs?.el.swiper?.autoplay?.start(),h.constructor?.getParentSwiper(h.el)?.autoplay?.start()),x&&(x.classList.add("tf_hide","tf_opacity"),x.tfOff(e.click,tt).tfOff("pointerdown",et).classList.remove("top_viewport","show_link")),a&&i.getSelection().removeAllRanges(),e.off("tfsmartresize",bt).off("tbresizeImageEditor",bt).off("tbDisableInline",gt),ht(),k.classList.remove("tb_editor_active","tb_editor_image_active","tb_editor_start_select"),p?.remove("tb_editor_active","tb_editor_image_active","tb_editor_start_select"),n.body.classList.remove("tb_editor_active","tb_editor_image_active","tb_editor_start_select"),_){const e=_.closest(".active_module");if(e&&(e.tfOff("dblclick",H,{passive:!0}).classList.remove("tb_editor_on","tb_editor_start"),R)){Z();for(let e=t.LightBox.el.tfClass("CodeMirror"),i=e.length-1;i>-1;--i){let t=e[i].CodeMirror;if(t){let o=e[i].previousElementSibling;o&&(t.setValue(o.value),setTimeout((()=>{t.refresh()}),10))}}_.hasAttribute("data-no-update")||c.inlineUpdateModule&&!c.inlineUpdateModule(_)||t.Utils.runJs(e,"module")}c.inlineEditorEnd&&c.inlineEditorEnd(_)}e.trigger("inlineEditorDisable",[c,_]),_&&t.undoManager.has("inline")&&t.undoManager.end("inline"),t.undoManager.clear("inline"),y||t.undoManager.enable(),G=[],L=-1,x=P=v=y=w=p=T=b=m=S=N=f=u=m=C=z=I=c=h=_=null}};e.on("themify_builder_ready",(()=>{let a=!1;t.Builder.get().el.tfOn("pointerdown",(e=>{if(a=B=!1,!1!==t.isPreview||!0!==t.inlineEditor||0!==e.button||e.ctrlKey||e.metaKey)gt();else{const o=e.target;A="IMG"===o.tagName;const n=A?o:o.closest("[contenteditable]");if(n&&!o.classList.contains("tb_disable_sorting")&&!n.closest(".tb_disable_sorting")&&(A||!n.isContentEditable)){rt(),i.getSelection().removeAllRanges();const s=n.closest(".active_module");if(s){const i=t.Registry.get(s.dataset.cid),a=o.dataset;if(!i||i.get("mod_settings").t?.[n.dataset.name]!==r||A&&!a.w&&!a.h&&!a.name&&!o.closest("[contenteditable]"))return void gt();e.stopPropagation(),s.closest(".tb_editor_on")?.classList.remove("tb_editor_on"),s.classList.add("tb_editor_start")}if(!A)try{n.contentEditable=!!n.hasAttribute("data-has-editor")||"plaintext-only"}catch(e){n.contentEditable=!0}let l=[],d=n.closest("[draggable]");while(null!==d)l.push(d),null!==d.parentNode&&(d=d.parentNode.closest("[draggable]"));if(l.length>0){const t=t=>{n.tfOff("pointermove",i,{passive:!0,once:!0});for(let t=l.length-1;t>-1;--t)l[t].tfOff("drag",i,{passive:!0,once:!0}).draggable=!1},i=e=>{n.tfOff("pointermove",i,{passive:!0,once:!0}).tfOff("pointerup",t,{passive:!0,once:!0}),A||(n.contentEditable=!1);for(let t=l.length-1;t>-1;--t)l[t].tfOff("drag",i,{passive:!0,once:!0});ht(),"drag"===e.type&&gt(),setTimeout((()=>{s?.classList.remove("tb_editor_start")}),150)};n.tfOn("pointerup",t,{passive:!0,once:!0}).tfOn("pointermove",i,{passive:!0,once:!0}).setPointerCapture(e.pointerId);for(let t=l.length-1;t>-1;--t)l[t].tfOn("drag",i,{passive:!0,once:!0})}a=!0}}}),{passive:!0}).tfOn(e.click,(async i=>{if(!a)return;let s=i.target;if(s.hasAttribute("data-target")){const t=s.closest(".active_module")?.querySelector(s.dataset.target);t&&(s=t)}await T,A="IMG"===s.tagName;const l=A?s:s.closest("[contenteditable]"),r=l?.closest(".active_module");if(!l)return void gt();if(l.closest("label,a,button")&&i.preventDefault(),_===l)return;if(0!==i.button||!r||A&&!l.dataset.w&&!l.dataset.h&&!l.dataset.name&&!l.closest("[data-has-editor]"))return void gt();await gt(),c=t.Registry.get(r.dataset.cid),y=!!t.undoManager.isDisabled,t.undoManager.disable(),R=!1,_=l,p=o.body.classList,rt(),k.classList.add("tb_editor_active"),p.add("tb_editor_active"),n.body.classList.add("tb_editor_active"),S=!A&&l.hasAttribute("data-has-editor"),r.classList.add("tb_editor_on"),r.classList.remove("tb_editor_start"),h=_.closest(".tf_swiper-container")?.swiper,h?.el&&(h.autoplay?.stop(),h.thumbs?.el.swiper?.autoplay?.stop(),h.constructor?.getParentSwiper(h.el)?.autoplay?.stop());let f=_,u=l.closest("form"),m=l.closest("[draggable]");if(u){const t=u.tfOn("submit",j).querySelectorAll("[required]");for(let e=t.length-1;e>-1;--e)t[e].removeAttribute("required"),t[e].dataset.required=1}while(f&&f!==r)f.style.animationName&&(f.dataset.tmpAnimation=f.style.animationName,f.style.animationName="none"),f=f.parentNode;while(null!==m)m.draggable=!1,m=m.parentNode.closest("[draggable]");if(f=m=u=null,A)p.add("tb_editor_image_active"),n.body.classList.add("tb_editor_image_active"),k.classList.add("tb_editor_image_active"),e.on("tfsmartresize",bt).on("tbresizeImageEditor",bt);else{try{_.contentEditable=!!S||"plaintext-only"}catch(i){_.contentEditable=!0}v=_.innerHTML,_.tfOn("input",it,{passive:!0}).focus(),e.isTouch||setTimeout((()=>{r&&(r.tfOff("dblclick",H,{passive:!0}).tfOn("dblclick",H,{passive:!0}),d.disableShortcuts||(n.tfOn("keydown",Q),o.tfOn("keydown",Q)))}),800)}e.on("tbDisableInline",gt),o.tfOn("pointerdown",gt,{passive:!0}),n.tfOn("pointerdown",gt,{passive:!0}),c.inlineEditorStart?.(_,A,S),S?(o.tfOn("selectionchange",lt,{passive:!0}),V(),W(),x.tfOn(e.click,tt).tfOn("pointerdown",et),I=x.querySelector("#link_btn"),z=x.querySelector("#dialog"),setTimeout((()=>{requestAnimationFrame(st),x.querySelector(".expand").classList.toggle("tf_hide",t.activeModel?.id===c?.id)}),30)):A&&(l.closest(".masonry")?e.requestIdleCallback((()=>{setTimeout((()=>{requestAnimationFrame((()=>{ut(l)}))}),25)}),500):ut(l))}))}),!0,t.is_builder_ready).on("disableInline",gt).on("documentsize",bt).on("isolayoutComplete",(t=>{_&&t.element.contains(_)&&bt()}))})(tb_app,Themify,window,document,window.top.document,tb_createElement,tb_createDocumentFragment,parseInt,void 0,themifyBuilder);