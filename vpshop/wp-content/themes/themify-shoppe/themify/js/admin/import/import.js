let TF_Import;((t,e,i)=>{"use strict";TF_Import={importImages:()=>t.loadJs(t.url+"js/admin/import/import-images",!!e.TF_ImportImages),init(r,o,a,f,l,n){return new Promise((async(s,c)=>{let p=!0;this.importImages(),await t.loadJs(t.url+"js/admin/notification",!!e.TF_Notification);const m=r.length,w=m>12?150:100,y=f.import_skip,g=[],u=f.limit>0?parseInt(f.limit):5,b=f.images_chunk,d=!!f.skip_builder,h=t=>{const e=[];for(let r=0,o=t.length;r<o;++r){let o="";t[r].tbp_template_name!==i?o=t[r].tbp_template_name:t[r].post_title!==i?o=t[r].post_title:t[r].title!==i?o=t[r].title.rendered??t[r].title:(t[r].name!==i||t[r].post_name!==i)&&(o=t[r].name),o!==i&&""!==o&&e.push(o)}return 0===e.length?"":e.join(", ")},j=e=>new Promise(((i,r)=>{setTimeout((()=>{let n={action:o,id:l||"",nonce:a,data:e};f.custom_params&&(n=Object.assign(n,f.custom_params)),t.fetch(n).then((t=>{t?.success&&t.data?i(t):r(t)})).catch(r)}),w)})),v=()=>{p="visible"===e.document.visibilityState},N=(t,e)=>{const i=[];while(t.length>0)i.push(t.splice(0,e));return i},I=t=>{const e=new Set,i=t=>{if(t){const i=t.split("?")[0].split(".");["jpg","jpeg","tiff","png","gif","bmp","svg","svgz","webp","apng","mp4","mpeg","mp3"].includes(i[i.length-1])&&e.add(t)}},r=t=>{for(let e in t)if(t[e])if(Array.isArray(t[e])||"object"==typeof t[e])r(t[e]);else{let r=(""+t[e]).trim();if(r&&isNaN(r))if(r.includes("<img ")||r.includes("<video ")||r.includes("<audio ")){let t=document.createElement("template");t.innerHTML=r;for(let e=t.content.querySelectorAll("img,video,audio"),r=e.length-1;r>-1;--r){let{src:t,srcset:o}=e[r];o=o?.split(" ")||[],t&&o.push(t);for(let t=o.length-1;t>-1;--t)o[t]&&i(o[t].trim())}}else if("["===r[0]&&r.includes("path=")){let t=r.match(/\path.*?=.*?[\'"](.+?)[\'"]/gim);if(t?.[0]){t=t[0].split("path=")[1].replaceAll('"',"").replace("'","").split(",");for(let e=t.length-1;e>-1;--e)t[e]&&i(t[e].trim())}}else i(r)}};return r(t),e},T=(t,e)=>new Promise((async r=>{let o=0,a=new Set,l=t.length,n=f.loading.replaceAll("%to%",l),s=N(t,e);for(let t=0;t<s.length;++t){let r=s[t];if(r.length>0){let f,c=h(r);if(l>1&&!0===p){o+=r.length;let t=n.replaceAll("%from%",o).replaceAll("%post%",c);t.length>120&&(t=t.slice(0,120)+"..."),await TF_Notification.show("info",t)}try{f=await j(r)}catch(t){try{f=await j(new Blob([JSON.stringify(r)],{type:"application/json"}))}catch(t){}}finally{if(f&&f.success&&f.data){let o=!1;const l=f.data;for(let t in l){let e=l[t];for(let f=r.length-1;f>-1;--f)if(r[f]!==i){if(t==(r[f].term_id||r[f].ID||r[f].post_id)){if(!1===e)a.add(r[f]);else if("object"==typeof e||isNaN(e)){let t="object"==typeof e?e.msg:e;if(!0===p&&await TF_Notification.showHide("warning",y.replaceAll("%post%",h([r[f]]))+":"+t,2e3),"object"==typeof e&&e.skip){for(let t=r.length-1;t>-1;--t){(r[t].post_type||r[t].taxonomy)===e.skip&&r.splice(t,1)}for(let t=s.length-1;t>-1;--t){for(let i=s[t].length-1;i>-1;--i){(s[t][i].post_type||s[t][i].taxonomy)===e.skip&&(s[t].splice(i,1),o=!0)}0===s[t].length&&s.splice(t,1)}}}else!0!==e&&(r[f].term_thumb?g.push({term_id:e,url:r[f].term_thumb.trim()}):r[f].thumb&&g.push({id:e,url:r[f].thumb.trim()}));r[f]!==i&&r.splice(f,1);break}}}if(!0===o){s=s.flat();for(let t=s.length-1;t>-1;--t)0===s[t].length&&s.splice(t,1);t=-1,s=N(s,e)}}else{!0===p&&await TF_Notification.showHide("error",y.replaceAll("%post%",c),2e3);for(let t=r.length-1;t>-1;--t)a.add(r[t])}}}}r(a)})),_=t=>(t.preventDefault(),t.returnValue="Are you sure"),O=t=>{Array.isArray(t)||(t=t?Object.values(t):[]);for(let e=t.length-1;e>-1;--e){let i=t[e].cols;if(i){Array.isArray(i)||(i=t[e].cols=Object.values(i));for(let t=i.length-1;t>-1;--t)i[t].modules&&(i[t].modules=O(i[t].modules))}}return t},S=t=>{for(let e=t.length-1;e>-1;--e){if(t[e].styling&&Object.keys(t[e].styling).length>0)return!0;let i=t[e].modules;if(i?.length>0)for(let t=i.length-1;t>-1;--t)if(!i[t].cols||S(i[t].cols))return!0}return!1};e.tfOff("beforeunload",_).tfOn("beforeunload",_).document.tfOff("visibilitychange",v,{passive:!0}).tfOn("visibilitychange",v,{passive:!0});let F=new Map;f.custom_data=l||"default",f.stop_webp=1;try{let t=new Set;for(let e=r.length-1;e>-1;--e){let i=r[e].meta_input?._themify_builder_settings_json||r[e]._themify_builder_settings_json;if(i){"string"==typeof i&&(i=JSON.parse(i)),i=O(i);let o=!1;for(let t=i.length-1;t>-1;--t)if(i[t].styling&&Object.keys(i[t].styling).length>0||i[t].cols&&S(i[t].cols)){o=!0;break}if(!1===o)r[e].meta_input?delete r[e].meta_input._themify_builder_settings_json:delete r[e]._themify_builder_settings_json;else if(!1===d){let e=I(i);e.size>0&&(t=new Set([...t,...e]))}}if(r[e].t){let i=r[e].t;i="string"==typeof i?i.split(","):i;for(let e=i.length-1;e>-1;--e)t.add(i[e].trim())}}if(t.size>0){await this.importImages(),F=await TF_ImportImages.init([...t],a,f,b,n);for(let t=r.length-1;t>-1;--t){let e=r[t].meta_input?._themify_builder_settings_json||r[t]._themify_builder_settings_json;if(e){"string"!=typeof e&&(e=JSON.stringify(e));for(let[i,o]of F)!1!==o&&o.src&&(e.includes(i)&&(e=e.replaceAll(i,o.src)),r[t].post_content?.includes(i)&&(r[t].post_content=r[t].post_content.replaceAll(i,o.src)));e=JSON.parse(e),r[t].meta_input?._themify_builder_settings_json?r[t].meta_input._themify_builder_settings_json=e:r[t]._themify_builder_settings_json=e}if(r[t].t){let e=r[t].t,i=[];e="string"==typeof e?e.split(","):e;for(let t=0,r=e.length;t<r;++t){let r=F.get(e[t].trim());r&&i.push(r.id)}i.length>0?r[t].t=i.join(","):delete r[t].t}}}}catch(t){}let A=await T(r,u);if(A.size>0&&(A=await T([...A],2),A.size>0&&!0===p&&await TF_Notification.showHide("error",f.import_failed.replaceAll("%post%",h(Array.from(A))),4e3)),A.size===m)c(Array.from(A));else{if(g.length>0){await this.importImages();try{const t=await TF_ImportImages.init(g,a,f,b,n);F=new Map([...t,...F])}catch(t){}}s([F,A])}e.tfOff("beforeunload",_).document.tfOff("visibilitychange",v,{passive:!0})}))},sort(t,e,r){const o=new Set,a=f=>{const l=parseInt(r===i?f[e]:f[e][r]),n=f.term_id>0?"term_id":"ID";for(var s=t.length-1;s>-1;--s)if(t[s][n]>0&&parseInt(t[s][n])===l){let f=t[s][e];r!==i&&(f=f[r]),f>0&&a(t[s]),o.add(t[s])}};for(var f=t.length-1;f>-1;--f){let a=t[f][e];r!==i&&(a=a[r]),a!==i&&0!=a||(o.add(t[f]),t.splice(f,1))}for(f=t.length-1;f>-1;--f){let l=t[f][e];r!==i&&(l=l[r]),l>0&&(a(t[f]),o.add(t[f]))}return[...o]}}})(Themify,window.top,void 0);